(function(m,i){typeof exports=="object"&&typeof module!="undefined"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(m=typeof globalThis!="undefined"?globalThis:m||self,i(m.MyLib={},m.Vue))})(this,function(m,i){"use strict";function F(t){return i.getCurrentScope()?(i.onScopeDispose(t),!0):!1}const I=typeof window!="undefined";function G(t,e){function n(...r){t(()=>e.apply(this,r),{fn:e,thisArg:this,args:r})}return n}function H(t,e={}){let n,r;return a=>{const s=i.unref(t),l=i.unref(e.maxWait);if(n&&clearTimeout(n),s<=0||l!==void 0&&l<=0)return r&&(clearTimeout(r),r=null),a();l&&!r&&(r=setTimeout(()=>{n&&clearTimeout(n),r=null,a()},l)),n=setTimeout(()=>{r&&clearTimeout(r),r=null,a()},s)}}function U(t,e=200,n={}){return G(H(e,n),t)}function K(t){var e;const n=i.unref(t);return(e=n==null?void 0:n.$el)!=null?e:n}const X=I?window:void 0,w=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},b="__vueuse_ssr_handlers__";w[b]=w[b]||{},w[b];var S=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,Q=(t,e)=>{var n={};for(var r in t)Y.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&S)for(var r of S(t))e.indexOf(r)<0&&q.call(t,r)&&(n[r]=t[r]);return n};function J(t,e,n={}){const r=n,{window:o=X}=r,a=Q(r,["window"]);let s;const l=o&&"ResizeObserver"in o,c=()=>{s&&(s.disconnect(),s=void 0)},u=i.watch(()=>K(t),d=>{c(),l&&o&&d&&(s=new ResizeObserver(e),s.observe(d,a))},{immediate:!0,flush:"post"}),f=()=>{c(),u()};return F(f),{isSupported:l,stop:f}}var z,E;I&&(window==null?void 0:window.navigator)&&((z=window==null?void 0:window.navigator)==null?void 0:z.platform)&&/iP(ad|hone|od)/.test((E=window==null?void 0:window.navigator)==null?void 0:E.platform);const Z=({breakpoints:t,wrapperWidth:e,gutter:n,hasAroundGutter:r,initWidth:o})=>{const a=Object.keys(t).map(u=>Number(u)).sort((u,f)=>u-f);let s=e,l=!1;for(const u of a)if(e<=u){s=u,l=!0;break}if(!l)return o;const c=t[s].rowPerView;return r?(e-n)/c-n:(e-(c-1)*n)/c};function tt(t){const e=i.ref(0),n=i.ref(null);J(n,s=>{const l=s[0],{width:c}=l.contentRect;e.value=c});const r=i.computed(()=>Z({wrapperWidth:e.value,breakpoints:t.breakpoints,gutter:t.gutter,hasAroundGutter:t.hasAroundGutter,initWidth:t.width})),o=i.computed(()=>{const s=t.hasAroundGutter?-t.gutter:t.gutter;return Math.floor((e.value+s)/(r.value+t.gutter))}),a=i.computed(()=>{const s=t.hasAroundGutter?t.gutter:-t.gutter,l=o.value*(r.value+t.gutter)+s;return(e.value-l)/2});return{waterfallWrapper:n,wrapperWidth:e,colWidth:r,cols:o,offsetX:a}}function $(t,e){return new RegExp(`(^|\\s)${e}(\\s|$)`).test(t.className)}function R(t,e){if($(t,e))return;const n=t.className.split(/\s+/);n.push(e),t.className=n.join(" ")}const et=document.createElement("div").style,A=(()=>{const t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(const e in t){const n=t[e];if(et[n]!==void 0)return e}return!1})();function h(t){return A===!1?!1:A==="standard"?t:A+t.charAt(0).toUpperCase()+t.substr(1)}const T=h("transform"),j=h("animation-duration"),P=h("animation-delay"),x=h("transition"),L=h("animation-fill-mode");function nt(t,e,n,r){const o=i.ref([]),a=i.ref(0),s=f=>{const d=t.hasAroundGutter?f+1:f;return t.gutter*d+e.value*f+r.value},l=()=>{o.value=new Array(n.value).fill(t.hasAroundGutter?t.gutter:0)},c=rt(t);return{wrapperHeight:a,layoutHandle:async()=>{l();const f=document.querySelectorAll(".waterfall-item");if(f.length===0)return!1;for(let d=0;d<f.length;d++){const g=f[d],y=Math.min.apply(null,o.value),_=o.value.indexOf(y),Ot=s(_),O=g.style;T&&(O[T]=`translate3d(${Ot}px,${y}px, 0)`),O.width=`${e.value}px`;const{height:It}=g.getBoundingClientRect();o.value[_]+=It+t.gutter,c(g,()=>{x&&(O[x]=".3s")})}a.value=Math.max.apply(null,o.value)}}}function rt(t){return(e,n)=>{const r=e.firstChild;if(r&&!$(r,t.animationPrefix)){const o=`${t.animationDuration/1e3}s`,a=`${t.animationDelay/1e3}s`,s=r.style;s.visibility="visible",j&&(s[j]=o),P&&(s[P]=a),L&&(s[L]="both"),R(r,t.animationPrefix),R(r,t.animationEffect),n&&setTimeout(()=>{n()},t.animationDuration+t.animationDelay)}}}const ot=typeof window!="undefined"&&window!==null,C=at(),it=Object.prototype.propertyIsEnumerable,k=Object.getOwnPropertySymbols;function st(t,...e){return e.map(r=>r.replace(/\[(\w+)\]/g,".$1").split(".").reduce((o,a)=>o&&o[a],t))}function at(){return ot&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function p(t){return typeof t=="function"||toString.call(t)==="[object Object]"}function lt(t){return typeof t=="object"?t===null:typeof t!="function"}function ct(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}function ut(t,...e){if(!p(t))throw new TypeError("expected the first argument to be an object");if(e.length===0||typeof Symbol!="function"||typeof k!="function")return t;for(const n of e){const r=k(n);for(const o of r)it.call(n,o)&&(t[o]=n[o])}return t}function B(t,...e){let n=0;for(lt(t)&&(t=e[n++]),t||(t={});n<e.length;n++)if(p(e[n])){for(const r of Object.keys(e[n]))ct(r)&&(p(t[r])&&p(e[n][r])?B(t[r],e[n][r]):t[r]=e[n][r]);ut(t,e[n])}return t}function D(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>{e(r)},r.onerror=()=>{n(new Error("Image load error"))},r.crossOrigin="Anonymous",r.src=t})}const ft={rootMargin:"0px",threshold:0},W="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",dt="";class mt{constructor(e=!0,n){this.lazyActive=!0,this.options={loading:W,error:dt,observerOptions:ft,log:!0},this._images=new WeakMap,this.lazyActive=e,this.config(n)}config(e={}){B(this.options,e)}mount(e,n,r){const{src:o,loading:a,error:s}=this._valueFormatter(n);e.setAttribute("lazy","loading"),e.setAttribute("src",a||W),this.lazyActive?(C||(this._setImageSrc(e,o,r,s),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,o,r,s)):this._setImageSrc(e,o,r,s)}resize(e,n){const r=e.getAttribute("lazy"),o=e.getAttribute("src");r&&r==="loaded"&&o&&D(o).then(a=>{const{width:s,height:l}=a,c=e.width/s*l;e.height=c;const u=e.style;u.height=`${c}px`,n()})}unmount(e){const n=this._realObserver(e);n&&n.unobserve(e),this._images.delete(e)}_setImageSrc(e,n,r,o){!n||e.getAttribute("src")===n||D(n).then(s=>{e.setAttribute("lazy","loaded"),e.removeAttribute("src"),e.setAttribute("src",n);const{width:l,height:c}=s,u=e.width/l*c;e.height=u;const f=e.style;f.height=`${u}px`,r()}).catch(()=>{const s=this._realObserver(e);s&&s.disconnect(),o&&(e.setAttribute("lazy","error"),e.setAttribute("src",o)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${n} `)}),r()})}_isOpenLazy(){return C&&this.lazyActive}_initIntersectionObserver(e,n,r,o){const a=this.options.observerOptions;this._images.set(e,new IntersectionObserver(l=>{Array.prototype.forEach.call(l,c=>{if(c.isIntersecting){const u=this._realObserver(e);u&&u.unobserve(c.target),this._setImageSrc(e,n,r,o)}})},a));const s=this._realObserver(e);s&&s.observe(e)}_valueFormatter(e){let n=e,r=this.options.loading,o=this.options.error;return p(e)&&(n=e.src,r=e.loading||this.options.loading,o=e.error||this.options.error),{src:n,loading:r,error:o}}_log(e){this.options.log&&e()}_realObserver(e){return this._images.get(e)}}var St="",N=(t,e)=>{const n=t.__vccOpts||t;for(const[r,o]of e)n[r]=o;return n};const v=i.defineComponent({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},hasAroundGutter:{type:Boolean,default:!0},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},delay:{type:Number,default:300}},setup(t){const e=new mt(t.lazyload,t.loadProps);i.provide("lazy",e);const{waterfallWrapper:n,wrapperWidth:r,colWidth:o,cols:a,offsetX:s}=tt(t),{wrapperHeight:l,layoutHandle:c}=nt(t,o,a,s),u=U(()=>{c()},t.delay);i.watch(()=>[r,o,t.list],()=>{u()},{deep:!0});const f=i.ref(0);return i.provide("sizeChangeTime",f),i.provide("imgLoaded",u),{waterfallWrapper:n,wrapperHeight:l,getRenderURL:y=>st(y,t.imgSelector)[0],getKey:(y,_)=>y[t.rowKey]||_}}}),M=()=>{i.useCssVars(t=>({"4b071780":t.backgroundColor}))},V=v.setup;v.setup=V?(t,e)=>(M(),V(t,e)):M;const yt=v,ht={class:"waterfall-card"};function pt(t,e,n,r,o,a){return i.openBlock(),i.createElementBlock("div",{ref:"waterfallWrapper",class:"waterfall-list",style:i.normalizeStyle({height:`${t.wrapperHeight}px`})},[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(t.list,(s,l)=>(i.openBlock(),i.createElementBlock("div",{key:t.getKey(s,l),class:"waterfall-item"},[i.createElementVNode("div",ht,[i.renderSlot(t.$slots,"item",{item:s,index:l,url:t.getRenderURL(s)},void 0,!0)])]))),128))],4)}var gt=N(yt,[["render",pt],["__scopeId","data-v-26853650"]]),zt="";const _t=i.defineComponent({props:{url:{type:String,default:""}},setup(t){const e=i.inject("imgLoaded"),n=i.inject("lazy"),r=i.ref(null);i.onMounted(()=>{o()}),i.onUnmounted(()=>{a()});function o(){!r.value||n.mount(r.value,t.url,()=>{e()})}function a(){!r.value||n.unmount(r.value)}return{lazyRef:r}}}),wt={class:"lazy__box"},bt={ref:"lazyRef",class:"lazy__img",alt:""};function At(t,e,n,r,o,a){return i.openBlock(),i.createElementBlock("div",wt,[i.createElementVNode("img",bt,null,512)])}var vt=N(_t,[["render",At],["__scopeId","data-v-05d7147b"]]);m.LazyImg=vt,m.Waterfall=gt,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
